
<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css"  href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.css">
    <script  src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.js">  </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-xmlrpc/0.4.3/jquery.xmlrpc.js"> </script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <link href="https://vjs.zencdn.net/7.8.4/video-js.css" rel="stylesheet" />
    <script src="http://vjs.zencdn.net/7.8.4/video.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/2.6.1/Youtube.min.js"></script>






    <script>

        function updateQuestionstable(){
            videoID = {{videoID}}
            $.ajax({
                url: "/API/"+videoID+"/Questions",
                type: "GET",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    $('#questionsTable > tbody:last-child').empty()
                    data["questions"].forEach(q => {
                        console.log(q["question_id"]+" "+q["description"])
                        $('#questionsTable > tbody:last-child').
                            append('<tr> <td>'+ q["time"]+'</td><td>' +q["description"]+'</td></tr>');
                    });
                }
            });

        }
        
        function addNewQuestion(time, description){
            requestData = {"description": description, 'time': time}
            videoID = {{videoID}}
            $.ajax({
                url: "/API/"+videoID+"/Questions/",
                type: "POST",
                dataType: "json",
                contentType: 'application/json',
                data: JSON.stringify(requestData),
                success: function(data){
                  console.log("resppnse for question creation"+data)
                  console.log(data)
                  updateQuestionstable()
                }
            });
        } 

        $(document).ready(function(){
        
            updateQuestionstable()
            
            src = "{{src}}";
            var vPlayer = videojs('videoPlayer');
            vPlayer.src({ "type": "video/youtube", "src": src});
            vPlayer.play()

            $("#buttonVideoPause").click(function(){
                vPlayer.pause()
                var pauseTime = vPlayer.currentTime()
                console.log(pauseTime)
                $("#resumetime").val(pauseTime)

             })
             
            $("#buttonVideoResume").click(function(){
                vPlayer.currentTime( parseFloat($("#resumetime").val()))
                vPlayer.play()
            })
            
            $("#buttonAddQuestion").click(function(){
                desc = $("#newQuestionDescription").val()
                time = $("#resumetime").val()
                addNewQuestion(time,desc)

             })
        });

    </script>

  </head>
  <body>
    <h3>{{title}}</h3>
    <video  id="videoPlayer" controls 
            class="video-js vjs-default-skin"
            width="640"
            data-setup='{ "autoplay": true, "preload": "auto", "techOrder": ["youtube"], "sources": [{ "type": "video/youtube" }'
    >
    </video>
    <h3>Control Video</h3>
    <button class="ui button" id="buttonVideoPause">
     PAUSE Video
    </button> 
    <div class="ui input focus" >
      <input type="text" id="resumetime">
    </div>
    <button class="ui button" id="buttonVideoResume">
      RESUME Video
    </button>
    
    <h3>Questions</h3>
    <table class="ui celled table selectable" id="questionsTable" >
      <thead>
        <tr>
          <th>Time</th>  <th>Question</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    
    <h3>Add a new Question</h3>
    <div class="ui input">
      <input type="text" placeholder="Question" id="newQuestionDescription">
    </div>
    <button class="ui button" id="buttonAddQuestion">
      Add new Question
    </button>

  </body>

</html>